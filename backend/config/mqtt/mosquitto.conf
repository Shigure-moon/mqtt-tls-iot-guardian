# Mosquitto MQTT Broker 配置

# ==================== 基本设置 ====================
# 允许匿名连接（开发环境，生产环境应关闭）
allow_anonymous true

# 如果启用密码认证，取消下面的注释并创建相应文件
# password_file /mosquitto/config/passwd
# acl_file /mosquitto/config/acl

# ==================== 端口监听 ====================
# 监听端口（不使用TLS，用于开发）
listener 1883 0.0.0.0
protocol mqtt
allow_anonymous true

# TLS监听端口（需要证书文件）
listener 8883 0.0.0.0
protocol mqtt
cafile /mosquitto/config/certs/ca.crt
certfile /mosquitto/config/certs/server.crt
keyfile /mosquitto/config/certs/server.key
require_certificate false
allow_anonymous true
tls_version tlsv1.2

# WebSocket 监听端口（用于前端实时通信）
listener 9001 0.0.0.0
protocol websockets
allow_anonymous true

# TLS WebSocket 监听端口（需要证书文件）
listener 9443 0.0.0.0
protocol websockets
allow_anonymous true
# 取消注释下面的TLS配置（如果证书存在）
# cafile /mosquitto/config/certs/ca.crt
# certfile /mosquitto/config/certs/server.crt
# keyfile /mosquitto/config/certs/server.key
# require_certificate false
# tls_version tlsv1.2

# ==================== 连接设置 ====================
# 连接消息
connection_messages true

# 最大连接数（-1表示无限制）
max_connections -1

# 允许零长度客户端ID（MQTT 3.1.1兼容）
allow_zero_length_clientid true

# ==================== 日志配置 ====================
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true

# ==================== 持久化 ====================
persistence true
persistence_location /mosquitto/data/
persistence_file mosquitto.db

# ==================== 消息设置 ====================
# 消息大小限制（字节，256MB）
max_packet_size 268435455

# 保留消息设置
retained_persistence true

# QoS 消息队列大小限制
max_queued_messages 1000

# ==================== 性能优化 ====================
# 自动保存间隔（秒）
autosave_interval 1800

# 系统消息更新间隔（秒，0表示禁用）
sys_interval 10

# ==================== 安全设置 ====================
# 允许零长度客户端ID
allow_zero_length_clientid true
